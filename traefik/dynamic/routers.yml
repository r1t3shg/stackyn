# Traefik Dynamic Router Configuration
# This file defines routing rules for services
#
# Router Configuration:
#   - Routes HTTP/HTTPS traffic to appropriate services
#   - Supports both .local (development) and production domains
#   - Automatic HTTPS redirect for production domains
#   - SSL/TLS termination via Let's Encrypt
#
# Migration Notes:
#   - Migrated from nginx configuration to Traefik
#   - Routes are defined here for static services (frontend/backend)
#   - Dynamic routes for deployed apps are configured via Docker labels

http:
  routers:
    # Note: Frontend routers are now configured via Docker labels in docker-compose.yml
    # Commented out to avoid conflicts with Docker label-based configuration
    
    # # Frontend Router - HTTP (for .local domains)
    # frontend-http:
    #   rule: "Host(`stackyn.local`)"
    #   entryPoints:
    #     - web
    #   service: frontend
    #   middlewares:
    #     - frontend-headers

    # # Frontend Router - HTTPS (for real domains with SSL)
    # frontend-https:
    #   rule: "Host(`staging.stackyn.com`)"
    #   entryPoints:
    #     - websecure
    #   service: frontend
    #   tls:
    #     certResolver: letsencrypt
    #   middlewares:
    #     - frontend-headers

    # # Frontend Router - HTTP to HTTPS redirect (for real domains)
    # frontend-redirect:
    #   rule: "Host(`staging.stackyn.com`)"
    #   entryPoints:
    #     - web
    #   middlewares:
    #     - https-redirect
    #   service: frontend

    # Backend API Router - HTTP (for .local domains)
    backend-http:
      rule: "Host(`api.stackyn.local`)"
      entryPoints:
        - web
      service: backend
      middlewares:
        - cors
        - backend-headers

    # Backend API Router - HTTPS (for real domains with SSL)
    backend-https:
      rule: "Host(`api.staging.stackyn.com`)"
      entryPoints:
        - websecure
      service: backend
      tls:
        certResolver: letsencrypt
      middlewares:
        - cors
        - backend-headers

    # Backend API Router - HTTP to HTTPS redirect (for real domains)
    backend-redirect:
      rule: "Host(`api.staging.stackyn.com`)"
      entryPoints:
        - web
      middlewares:
        - https-redirect
      service: backend

