# VPS Deployment Checklist

Use this checklist when deploying Stackyn to a VPS.

## Pre-Deployment

- [ ] Server has Docker and Docker Compose installed
- [ ] Ports 80, 443 (and optionally 8080) are open
- [ ] Domain DNS is pointing to server IP
- [ ] Git repository cloned or files uploaded

## File Structure Setup

- [ ] Create required directories:
  ```bash
  mkdir -p traefik/{dynamic,acme}
  mkdir -p volumes/{db,redis,logs}
  mkdir -p apps
  mkdir -p backend/config
  ```

- [ ] Create `.gitkeep` files for empty directories (if needed):
  ```bash
  touch traefik/acme/.gitkeep
  touch volumes/{db,redis,logs}/.gitkeep
  touch apps/.gitkeep
  ```

## Configuration Files

- [ ] Create `backend/config/prod.env`:
  ```bash
  cp backend/config/prod.env.example backend/config/prod.env
  # Edit with actual values
  ```

- [ ] Update `traefik/traefik.yml`:
  - [ ] Set email for Let's Encrypt
  - [ ] Configure dashboard (secure in production)

- [ ] Update `traefik/dynamic/routers.yml`:
  - [ ] Replace `stackyn.local` with your domain
  - [ ] Replace `staging.stackyn.com` with production domain

- [ ] Update `docker-compose.yml`:
  - [ ] Update `VITE_API_BASE_URL` build arg for frontend
  - [ ] Update environment variables
  - [ ] Review service labels

## SSL Certificates

- [ ] Create ACME directory:
  ```bash
  touch traefik/acme/acme.json
  chmod 600 traefik/acme/acme.json
  ```

## Security

- [ ] Change default passwords in `backend/config/prod.env`
- [ ] Review Traefik dashboard access (disable or secure)
- [ ] Set proper file permissions:
  ```bash
  chmod 600 traefik/acme/acme.json
  chmod 600 backend/config/prod.env
  ```

## Build and Deploy

- [ ] Build images:
  ```bash
  docker compose build
  ```

- [ ] Start services:
  ```bash
  docker compose up -d
  ```

- [ ] Verify services are running:
  ```bash
  docker compose ps
  ```

## Verification

- [ ] Check Traefik logs:
  ```bash
  docker compose logs traefik
  ```

- [ ] Check Backend logs:
  ```bash
  docker compose logs backend
  ```

- [ ] Check Frontend logs:
  ```bash
  docker compose logs frontend
  ```

- [ ] Test Frontend:
  - [ ] Access `https://your-domain.com`
  - [ ] Verify SSL certificate is valid

- [ ] Test Backend API:
  - [ ] Access `https://api.your-domain.com/health`
  - [ ] Verify SSL certificate is valid

- [ ] Test Database:
  ```bash
  docker compose exec postgres psql -U stackyn -d stackyn -c "SELECT 1;"
  ```

## Post-Deployment

- [ ] Set up log rotation
- [ ] Configure backups for:
  - [ ] Database (`volumes/db/`)
  - [ ] Configuration files
  - [ ] SSL certificates
- [ ] Set up monitoring
- [ ] Document any custom configurations

## Files NOT on VPS

These files are in `.gitignore` and should NOT be on VPS:
- ❌ `node_modules/` - Install via `npm install`
- ❌ `frontend/dist/` - Build via `npm run build` or Docker
- ❌ `backend/bin/` - Build via `go build` or Docker
- ❌ `*.exe` - Windows executables
- ❌ `.env` files - Create from `.example` files
- ❌ `traefik/acme/acme.json` - Auto-generated by Traefik
- ❌ `volumes/` - Created at runtime
- ❌ `apps/*/` - User apps created at runtime
- ❌ Old Next.js files - Not needed after migration

## Troubleshooting

If something doesn't work:

1. Check logs: `docker compose logs -f [service]`
2. Verify configuration files exist
3. Check file permissions
4. Verify DNS is correct
5. Check firewall rules
6. Review Traefik dashboard (if enabled)

